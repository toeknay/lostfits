{
  auto_https off
  admin off
}

:80 {
  encode zstd gzip

  # Use route to ensure proper order of processing
  route {
    # API routes - proxy to backend
    reverse_proxy /api/* api:8000
    reverse_proxy /docs api:8000
    reverse_proxy /docs/* api:8000
    reverse_proxy /openapi.json api:8000

    # Frontend SPA - serve static files with fallback to index.html
    root * /srv/www
    try_files {path} /index.html
    file_server
  }

  log {
    output stdout
    format console
  }
}
